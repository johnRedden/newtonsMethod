<!DOCTYPE html>
<html lang="en">
<head>
  <title>Newton's Method</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="js/mathjs.js"></script>
  <!-- MathJax from CDN -->
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <!-- Algebrite -->
  <script src="js/algebrite.bundle-for-browser.js"></script>
  <!-- JSX Graph -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.99.5/jsxgraphcore.js"></script>
  <style>
   #functioninput{
     width:80%;
     margin: 0 auto;
   }
   
   #functionoutput{ 
     margin-top: 10px;
     margin-bottom: 10px;
   }
   
   #derivativeoutput{
     margin-bottom: 10px;
   }
   
   #myGraph{
     margin-bottom: 15px;
     visibility: hidden;
   }
   
   #guessInputGroup{
     width:20%;
     margin: 0 auto;
     visibility: hidden;
   }
   
   #AnswersDiv{
     margin-top: 25px;
     margin-bottom: 40px;
     visibility: hidden;
   }
    
  </style>

</head>
<body>
  
<div class="container">
  <h1 class="text-center">Newton's Method</h1>
  <div class="input-group" id="functioninput">
    <span class="input-group-addon" id="basic-addon1">f(x) = </span>
    <input type="text" class="form-control" id="inputfunction" placeholder="Enter function" aria-describedby="basic-addon1" autofocus>
  </div>
  <div id="functionoutput" class="text-center"></div>
  <div id="derivativeoutput" class="text-center"></div>
  <!--Graph Div-->
  <div id="myGraph" class="jxgbox center-block" style='width:500px; height:300px; border: 1px solid lightgray;'></div>
  
  <div class="input-group" id="guessInputGroup">
    <span class="input-group-addon" id="basic-addon1">User Guess = </span>
    <input type="text" class="form-control" id="userGuess" aria-describedby="basic-addon1">
  </div> 
  
  <div id="AnswersDiv" align="left">
      <div class="row">
          <div id = "col_Left" class="col-xs-6"><p id="myOutput">Answer</p></div>
          <div id = "col_Right" class="col-xs-6"><p id="changeX">Change of X</p></div>
      </div>
  </div>
    
</div>

<script>
  
  var userGuess;
  var Result;
  var counter = 1;
  var answer;
  var delta;
  var Result = ""; //Used to output iterations of x
  var ChangeOfxResult = ""; // used to output results for change of x
  var XiterationsArray = ["Results"]; //storing information into array for resizing with slider
  var ChangeofXArray = ["Change of X"]; //same purpose as the XitterationsArray but for Change of x

  
  $(document).ready(function(){
    
    $("#inputfunction").on("keyup", function(e){
      
      //Graph
         board = JXG.JSXGraph.initBoard('myGraph',
                     {
                         boundingbox:[-7,2,7,-2],
                         axis: { ticks: { drawLabels: true }, firstArrow: true, strokeColor: 'black' },
                         grid: { strokeWidth: 0.75 },
                         showCopyright: false,
                         showNavigation: false,
                         keepaspectratio: false, //square graph coming in
                         zoom: {
                            factorX: 1.25,  // horizontal zoom factor (multiplied to JXG.Board#zoomX)
                            factorY: 1.25,  // vertical zoom factor (multiplied to JXG.Board#zoomY)
                            wheel: true,   // allow zooming by mouse wheel
                            needshift: false, // mouse wheel zooming needs pressing of the shift key
                             eps: 0.1        // minimal values of JXG.Board#zoomX and JXG.Board#zoomY
                         },
                         pan: {
                            enabled: true,   // Allow panning
                            needTwoFingers: true, // panningis done with two fingers on touch devices
                            needshift: false, // mouse panning needs pressing of the shift key
                         }
                         
                     });
           
       board.removeObject(myGraph);
      
      $("#derivativeoutput").html("Hit Enter");
     
      var initialfunction = $(this).val();
      
      $("#functionoutput").html("`f(x) = " + initialfunction + "`");
      MathJax.Hub.Queue(["Typeset",MathJax.Hub,"functionoutput"]);
      
      if(e.keyCode === 13){
        var derivativefunction = Algebrite.run('d('+ initialfunction +')');
        
        $("#derivativeoutput").html("`f'(x) = " + derivativefunction + "`");
        MathJax.Hub.Queue(["Typeset",MathJax.Hub,"derivativeoutput"]);
        
        
          
          // now getting the function and derivative into jsmath
          jsinitialfunction = mathjs(initialfunction, 'x');
          jsderivfunction = mathjs(derivativefunction, 'x');
            
          // fade in graph and next input box           
          $('#myGraph').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 500);
          $("#myGraph").show(500);
          DrawingGraph = board.create('functiongraph',[function(x){ with(Math) return eval(jsinitialfunction);}]);
          
          $('#guessInputGroup').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 500);
          $("#guessInputGroup").show(1000);
          
          
          $("#userGuess").on("keyup", function(e){
             if(e.keyCode === 13){
              Result = "";
              ChangeOfxResult = "";
            
              userGuess = $("#userGuess").val();
              userGuess = parseInt(userGuess);
              
              Result += "x0 = " + userGuess + "<br>";
              
              do{  //Applying Newtons Method
                        
                        // Use Math to access trig functions
                        var evalInitialFunction;
                        var evalDerivFunction;
                        with(Math){
                        evalInitialFunction = eval(jsinitialfunction.replace(/x/g, userGuess));
                        evalDerivFunction = eval(jsderivfunction.replace(/x/g, userGuess));
                        }
                                          
                        answer = userGuess - (evalInitialFunction/evalDerivFunction);
                        
                        
                        //Set Delta
                        delta = answer - userGuess;
                              
                        //Set new userGuess
                        userGuess = answer;
                        
                    
                        Result += "x" + counter + " = " + answer + "<br>";//Writing to MyOutput String
                        XiterationsArray[counter] = answer;//filling array
                
                        
                        ChangeOfxResult += "<span>&#916;</span>x" + counter + "= " + delta + "<br>"; //Writing to ChangeX string
                        ChangeofXArray[counter] = delta;//filling array with each change of x
    
                        counter ++;
                        
                        if (counter > 10000){
    
                            Result = "It looks like this function doesn't converge to a root!"; //+ "<br>" + Result
                            ChangeOfxResult = "";
                            
                            break;
                          
                        }
                        //console.log(Result);
                        if (answer == "NaN" || answer == "Infinity"){

                           Result = "No Root was found";
                           ChangeOfxResult = "";
                           break;

                        }
    
                    }while(delta > 0.001 || delta < -0.001);
                    
                  //Plot Crit
                  var p = board.create('point', [answer,0], {style:6, name:'p'}); 
              
                  //Fade in answers
                  $('#AnswersDiv').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 500);
                  $('#myOutput').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 1000);
                  $('#changeX').css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 }, 1 * 1500);
                  $("#AnswersDiv").show(500);
                  $("#myOutput").show(1000);
                  $("#changeX").show(1500);
              
                  $('#myOutput').html(Result);
                  $('#changeX').html(ChangeOfxResult);
              
               }
              });

             
          
          
        
      }
      
    });
    
  });
    
  
  
</script>

</body>
</html>